-------------------------------------数据库基础知识开始------------------------------------------------- 
1、为什么用自增列做为主键？
答：为什么我们定义了主键（PRIMARY KEY），那么InnoDB会选择主键为聚集索引（如果没有显示定义，InnoDB会默认选择第一个不包含
    null的唯一索引作为主键索引）
    数据记录本身存于 b+tree 的叶子节点上，这就要求统一叶子节点内的各条数据记录按主键顺序存放
    如果使用自增列做主键，那么每次添加新的数据，就会顺序添加到当前节点的后续位置，当一页写满在开辟新的一页
    如果是非自增索引列，由于数值是随机的，则每次添加时会被插入到现有索引页中的某个位置（此时MySQL不得不为了将新记录插到合适位置⽽移动数据，甚⾄⽬标⻚⾯可能已经被回写到磁盘上⽽从缓存中清掉，此时⼜要从
    磁盘上读回来，这增加了很多开销）

2、为什么使用数据索引能提高效率？
答：索引的存储是有序的
    在有序的情况下，查询一个数据是无需遍历索引记录的
    极端情况下，索引的查询效率为二分查找的效率，时间复杂度趋近于O(log₂N)

3、B+树与hash索引的区别？
答：B+树是一个平衡多叉树，从根节点到叶子节点的高度差值不超过1，而且同层级的节点之间有指针相互连接，是有序的；
    哈希索引就是采用一定的哈希算法，把键值换算成新的哈希值，检索时不需要类似B+树那样从根节点查到叶子节点逐级查找，只需要一次哈希算法即可，时无序的；

4、哈希索引的优势？
等值查询，（在没有大量重复键值，如果大量重复键值时，哈希索引的效率很低，存在hash碰撞问题）哈希索引具有绝对优势；

5、哈希索引不适用的场景？
答：不支持范围查询
    不支持索引完成排序
    不支持联合索引的最左前缀匹配规则

6、MySQL联合索引？
答：联合索引是两个或者多个列上的索引（对于联合索引:Mysql从左到右的使⽤索引中的字段，⼀个查询可以只使⽤索引中的⼀部份，但只能是最左侧部分）
    利用索引的附加列，您可以缩小搜索的范围，但使用一个具有两列的索引不同于使用两个单独的索引

7、什么情况下应不建或少建索引？
答：表记录太少
    经常插入、删除、修改的表
    数据重复且分布平均的表字段
    经常和主字段一块查询但主字段索引值比较多的表字段

8、什么是表分区？
答：表分区，是根据一定规则，将数据库中的一张表分解成多个更小的，容易管理的部分。从逻辑上看，只有一张表，但是底层确实多个物理分区组成；

9、表分区与分表的区别？
答：分表：通过一定规则，将一张表分解成多张不同的表。比如将用户订单记录根据时间分成多个表；
    表分区：分区从逻辑上来讲只有一张表，而分表则是将一张表分解成多张表；

10、常说的事务的ACID是什么？
答：原子性（Atomicity）：一个事物不能被切分为更小单元，整个操作要么全部成功要么全部失败；
    一致性（Consistency）：数据库总能从一个一致性的状态转换为另一个一致性的状态，主要有任何一方发生异常，事务提交就会失败；
    隔离性（Isolation）：一个事务对另一个事务是隔离的，一个事务锁做的修改是最终提交以前，对其他事务是不可见的；
    持久性（Durability）：一旦事务提交，则其所作的修改回永久保存到数据库中；

11、解释脏读，不可重复读，幻读的意思？
答：脏读：事务A对数据进行操作，还未进行提交，此时B读到了A还未提交的数据，若事务A进行了回滚，就会导致事务B读取不到A修改的数据，这就是脏读；
    不可重复读：事务A对数据进行操作，事务B将同一条数据进行了修改，导致事务A再次获取数据时，拿到了不同的数据；
    幻读：在某个事务读取某个范围的数据时，另一个事务在该范围内又插入了几条数据，导致每次查询到的数据不一样，就像发生了幻觉一样；
    区别：
    幻读和不可重复读区别在于：前者是一个范围，后者是对同一条数据，但是两者都表现为两次读取的数据不一致；

12、mysql的事务隔离级别？
答：四种隔离级别：
    1、读未提交（read-uncommitted）:会发生脏读，可重复读，幻读
    2、读已提交/不可重复读（read-committed）:会发生可重复读、幻读
    3、可重复读（repeatable-read）：会发生幻读（mysql默认的事务隔离级别）
    4、串行化（serializable）：

13、如何防止事务并发问题？
答：1、事务隔离机制
    2、MVCC多版本隔离机制
    3、锁机制等

14、创建索引主要考虑些什么，使用索引的优缺点有哪些？应该注意什么？
答：考虑点：结合实际的业务场景，在哪些字段上创建索引，创建什么类型的索引
索引的好处：快速定位到表的位置，减少服务器的扫描次数；
          有些索引存储的实际的数据，特定的情况下只要使用索引就能完成查询；
索引的缺点：索引会浪费磁盘空间，不要创建非必要的索引
          插入，跟新，删除需要维护索引，带来额外的开销
          索引过多，修改表的时候重构索引性能差
索引优化实践：前缀索引，特别是TEXT和BLOG类型的字段，只检索前面几个字符，提高索引速度
            尽量使用数据量少的索引，索引值过长查询速度会受到影响
            选择合适的索引列顺序
            内容变动少，且查询频繁，可以考虑建立索引，内容变动频繁，谨慎创建索引
            组合索引选择业务最相关的字段

15、是否有大数据分页优化思路，线上一个商品表数据量过千万，做深度分页的时候性能慢，有什么优化思路
答：慢的原因 select语句执行limit进行分页的时候，需要先扫描到N行，再去取M行，N越大，扫描的条数越多，mysql性能越差
    解决方案：1、后端、前端缓存，使用ElasticSearch进行分页搜索
            2、合理使用MySQL查询缓存，覆盖索引进行分页（查询索引字段）
            3、如果id是自增，并且中间不存在删除的情况下，使用子查询优化，定位偏移位置的id（select * 和 select id）

16、生产环境的数据库，你会做哪些操作保证安全？
答：业务性能：1、应用上线前会审查业务新增的sql,和分析sql执行计划，例如：是否存在select *，索引创建是否合理
            2、开启慢查询日志，定期分析慢查询日志
            3、监控CPU/内存利用率，读写，网关IO，流量带宽
            4、吞吐量QPS/TPS，一天内读写随时间变化统计
    数据安全：1、短期增量备份，比如一周一次，定期全量备份，比如一月一次
            2、检查是否有非授权用户，是否存在弱口令，网络防火墙检查
            3、导出数据是否进行脱敏，防止数据泄露或黑产利用
            4、数据库，全量操作日志审计，防止数据泄露
            5、数据库账号密码，业务独立，权限独立控制，防止多库公用同个账号密码

17、你知道mysql有多少种日志，分别解释一下？
答：redo日志->重做日志 作用：确保事务的持久性，防止在发生故障，脏页未写入磁盘，重启数据库会进行redo log执行重做，达到事务一致性。
    undo->回滚日志  作用：保证数据的原子性，记录事务发生之前的数据的一个版本，用于回滚。
                    innodb事务的可重复读和读已提交 隔离级别就是通过mvcc+undo实现
    errorlog->错误日志  作用：mysql本身启动，停止，运行期间产生的错误信息
    slow query log->慢查询日志  作用：记录执行时间过长的sql，时间阈值可以记录，只记录执行成功的sql
    binlog->二进制日志  作用：用于主从复制，实现主从同步
    relay log->中继日志  作用：用于数据库主从同步，将主库法老的binlog先保存到本地，然后从库在进行回放
    general log->普通日志  作用：记录数据库操作明细，默认关闭，开启会降低数据库性能

-------------------------------------数据库基础知识结束-------------------------------------------------
-------------------------------------数据库优化思路开始-------------------------------------------------
文件来源于电脑：file:///D:/BaiduNetdiskDownload/java后端学习pdf/SQL.pdf
1、优化思路，优化的是什么？ 
答：在数据库优化上有两个主要方向：数据和安全
    安全：数据可持续性
    数据：数据的高性能访问
2、优化的范围？
答：1、存储、主机和操作系统方便：(1)主机架构稳定性(2)I/O规划及配置(3)Swap交换分区(4)OS内核参数和网络问题
    2、应用程序方便：(1)应用程序稳定性(2)sql语句性能(3)串行化访问资源(4)性能欠佳会话管理(5)这个应用适不适合用MySQL
    3、数据库优化方便：(1)内存(2)数据库结构(物理&逻辑)(3)实例配置
说明：不管是在，设计系统，定位问题还是优化，都可以按照这个顺序执行；
3、优化的维度？
答：数据库优化维度主要有4个：硬件，系统配置，数据库表结构，SQL及索引
优化选择：优化成本：硬件>系统配置>数据库表结构>sql及索引
        优化效果：硬件<系统配置<数据库表结构<sql及索引
4、数据库层面，常用问题检测命令？
答：mysqladmin  mysql客户端，可进行管理操作
    mysqlshow  功能强大的查看shell命令
    show [SESSION | GLOBAL] variables 查看数据库参数信息
    show [SESSION | GLOBAL] STATUS    查看数据库状态信息
    information_schema                获取元素据的方法
    show ENGINE INNODB STATUS         Innodb引擎的所有状态
    show PROCESSLIST                  查看当前所有连接session状态
    explain                           获取查询语句的执行计划
    show index                        查看表的索引信息
    show-log                          记录慢查询sql
    mysqldumpslow                     分析slowlog文件  
5、数据库层面问题解决思路(sql优化)
一般应急调优思路：
    针对突然的业务卡顿，需立马处理时：(1)show processlist(2)explain 查询语句;show index from table
        (3)通过执行计划判断，索引问题(有没有，合不合理)，或者sql语句本身问题
        (4)show status like '%lock%' 查询锁状态  (5)kill SESSION_ID 杀掉所有异常的SESSION_ID
常规优化思路：
    针对业务周期性卡顿，例如每天10-11点业务慢，但是还能够使用，过了这段时间就好了的情况？
    (1)查看showlog日志，分析慢查询日志，找出慢查询sql (2)按照一定优先级，进行一个一个的排查慢语句
    (3)分析top sql，进行explain调试，查看语句执行时间 (4)调整索引或语句本身

6、基础优化，优化思路？
答：定位问题：硬件->系统->应用->数据库->架构(高可用，读写分离，分库分表)
    处理方向：明确优化目标、性能和安全的折中、防范未然
    1、硬件优化：file:///D:/BaiduNetdiskDownload/java后端学习pdf/SQL.pdf
    2、服务器优化：
    3、系统优化：CPU、内存、swap(MySQL尽量避免使用swap，阿里云服务器中swap默认为O)、IO
    4、系统参数调整：Linux系统内核参数优化等
    5、应用优化：业务应⽤和数据库应⽤独⽴,防⽕墙：iptables、selinux等其他⽆⽤服务(关闭)
    6、数据库优化：(1)实例调整，如并发线程数、排序缓存大小、顺序读取缓存大小、索引缓存大小、线程缓存打小
                (2)连接层，设置合理的连接方式和连接客户端，如最大连接数、最大错误连接数、连接超时时间、等待超时时间等
                (3)sql层，querycahcesize:查询缓存-->OLAP类型数据库，需要重点加大此内存缓存，一般不会超过1GB
                对于经常被修改的数据，缓存会立马失效，我们可采用非关系数据库(redis，memacache)替代缓存功能
                (OLAP解释： https://blog.csdn.net/qq_42322103/article/details/104510059)
    7、存储引擎层(Innodb基础优化参数)等等

-------------------------------------数据库优化思路结束-------------------------------------------------
-------------------------------------数据库索引开始-------------------------------------------------
1、什么是索引？
答：索引是一种数据结构，可以帮助我们快速的进行数据的查找
2、索引是一个什么数据结构呢？
答：索引的数据结构一般和存储引擎相关，在MySQL中使用较多的有hash索引和B+树索引，Innodb默认使用B+树索引
3、Hash索引和B+树索引有什么区别或者说劣势呢？
答：hash索引的底层是hash表，进行查找时，调用一次hash函数就能获取到相应的键值，之后进行回表查询就能获取到实际数据
    B+数索引底层是多路平衡查找树，对于每一次查询都是从根节点出发，查找到叶子节点即可获得所查的键值，然后在判断是否需要进行回表查询
区别：
    1、hash索引一般在等值查询时速度快，但是不支持范围查询，因为在hash索引生成之后，索引的顺序无法与原顺序保持一致，范围顺序错乱
    而B+树所有节点接遵循（左节点小于右节点，右节点大于父节点，多叉树也类似），故支持范围查询
    2、hash索引任何时候都无法避免回表查询，而B+树在符合某些条件(聚簇索引,覆盖索引等)的时候可以只通过索引获取到实际数据
    3、hash索引咋虽然在等值查询上速度快，但是也存在hash碰撞问题，如果某个键值大量重复的时候，发生hash碰撞，此时效率极低，
    而B+树更加稳定
4、B+数在满足聚簇索引，覆盖索引的时候不需要进行回表，什么是聚簇索引？
答：在B+数索引中，叶子节点可能存储了当前key值，也可能存储了当前key值和整行的数据。这就是聚簇索引的特点
    在Innodb中只有主键索引是聚簇索引，没有主键，则选择唯一键建立，如果没有唯一键，则会隐式生成一个键来建立聚簇索引
    当查询使用了聚簇索引时，在对应的叶子节点，可以获取到整行数据，因此不用再次进行回表查询
5、非聚簇索引一定会进行回表查询吗？
答：不一定，当查询语句所以要求的子段全部都命中了索引，就不必在进行回表查询了。
6、在建立索引的时候，需要考虑的因素？
答：建立索引的时候一般要考虑到子段的使用频率，经常作为条件进行查询的子段比较合适，如果需要建立联合索引还需要考虑联合索引
    的顺序
7、联合索引是什么，为什么要注意了联合索引中的顺序？
答：MySQL可以使用多个字段同时建立一个索引，叫做来那个索引，在联合索引中，如果想要命中索引，需要按照建立索引的字段顺序
    挨个使用，否则无法命中索引
8、那些情况下会发生创建了索引，但是查询的时候索引并没有生效？
答：(1)使用不等于查询(2)列参与了数学运算或则函数(3)在字符串like时左边有通配符%时，不生效(4)当mysql分析全表扫描比使用索引快
    的时候不使用索引(5)当使用联合索引，前面一个条件作为范围查询，后面的即使符合最左前缀原则，也无法使用索引
-------------------------------------数据库索引结束-------------------------------------------------

-------------------------------------数据库-锁-结束-------------------------------------------------
1、对mysql锁了解吗？
答：当数据库发生并发事务的时候，可能会产生数据的不一致，这时候需要一些机制来保证访问的次序，这就是锁机制。
2、MySQL都有那些锁呢？像上面那样进行锁岂不是有点阻碍并发率吗？
答：共享锁和排他锁
    共享锁：也叫读锁，读数据时加上读锁，允许同时加上多个；
    排他锁：也叫写锁，写锁一次只能加一个，和其他锁都互斥；
锁的粒度取决于存储引擎，Innodb引擎实现了行锁，页级锁，表级锁(加锁开销从大到小，并发能力也是从大到小)
3、为什么尽量使用一个自增主键？
答：主键是数据库确保数据行在整张表唯一性的保障，即使业务上本张表没有主键，也建议添加一个自增长的ID作为主键，设定了主键之后对后续的增删改查
    可能更加快速以及确保操作数据范围安全
4、主键使用自增id还是UUID？
答：推荐使用自增ID,而不使用UUID
    在Innodb存储引擎中，主键索引是作为聚簇索引存在的，也就是说，主键索引的B+树叶子节点上存储了顺序排列的索引以及数据，如果主键是自增的，那么
    只需要不断向后排列即可，如果是UUID，由于到来的ID与原来大小不确定，会造成非常多的数据插入，数据移动，然后导致产生很多的内存碎片，影响插入性能
5、如果要存储用户的密码散列，应该使用什么字段进行存储？
答：密码散列，盐，用户身份证号等固定长度的字符，应该使用char而不是varchar来存储，这样可以节省空间且提高检索效率



-------------------------------------数据库-锁-结束-------------------------------------------------






